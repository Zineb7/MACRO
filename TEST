 ' Boucle sur chaque cellule de la ligne
            For Each cell In currentRow.Cells
                If IsEmpty(cell.Value) Or cell.Value = "NA" Then
                    sqlQuery = sqlQuery & "'4', "  ' Remplace NA par 4
                Else
                    sqlQuery = sqlQuery & "'" & cell.Value & "', "
                End If
            Next cell



Sub ConvertirExcelEnSQL_FilialesComplexes()
    Dim dossier As String, fichier As String
    Dim wb As Workbook, ws As Worksheet
    Dim fileNum As Integer, sqlFile As String
    Dim sqlQuery As String, dataRange As Range
    Dim currentRow As Range, cell As Range
    Dim dateValue As String
    Dim nomFichier As String
    Dim headers As Range, lastCol As Integer
    Dim colNames As String
    Dim i As Integer
    Dim filialeCols As Range
    Dim firstDataRow As Integer

    ' D√©finir le dossier contenant les fichiers Excel
    dossier = "C:\chemin\vers\les\fichiers\"

    ' R√©cup√©rer le premier fichier Excel du dossier
    fichier = Dir(dossier & "*.xlsx")

    ' Boucle sur tous les fichiers Excel du dossier
    Do While fichier <> ""
        ' Ouvrir le fichier Excel
        Set wb = Workbooks.Open(dossier & fichier)
        Set ws = wb.Sheets(1) ' Modifier si besoin

        ' V√©rifier que la cellule R3 contient une date
        If IsDate(ws.Range("R3").Value) Then
            dateValue = Format(ws.Range("R3").Value, "yyyy-mm-dd")
        Else
            MsgBox "Erreur : la cellule R3 ne contient pas une date valide dans le fichier " & fichier
            wb.Close False
            fichier = Dir() ' Passer au fichier suivant
            GoTo NextFile
        End If

        ' Extraire le nom du fichier sans extension
        nomFichier = Mid(fichier, 4, 8) ' Extrait GA2025MMJJ

        ' Trouver dynamiquement la ligne contenant les titres des colonnes des filiales (ex: ligne 7)
        Set filialeCols = ws.Range(ws.Cells(7, 4), ws.Cells(7, ws.Cells(7, Columns.Count).End(xlToLeft).Column))

        ' D√©tection de la derni√®re colonne des filiales
        lastCol = filialeCols.Cells(filialeCols.Cells.Count).Column

        ' Stocker les noms des colonnes des filiales
        colNames = "[Filiale], "
        For Each cell In filialeCols
            colNames = colNames & "[" & cell.Value & "], "
        Next cell

        ' Supprimer la derni√®re virgule
        colNames = Left(colNames, Len(colNames) - 2)

        ' D√©finir le fichier SQL de sortie
        sqlFile = dossier & "insert_" & nomFichier & ".sql"
        fileNum = FreeFile
        Open sqlFile For Output As #fileNum

        ' D√©finir la premi√®re ligne contenant les donn√©es (ex: ligne 8)
        firstDataRow = 8
        Set dataRange = ws.Range(ws.Cells(firstDataRow, 2), ws.Cells(ws.Cells(Rows.Count, 2).End(xlUp).Row, lastCol))

        ' Boucle sur chaque ligne de donn√©es
        For Each currentRow In dataRange.Rows
            sqlQuery = "INSERT INTO morningcheck (" & colNames & ", date) VALUES ("

            ' Ajouter le nom de la filiale (colonne B)
            sqlQuery = sqlQuery & "'" & currentRow.Cells(1, 1).Value & "', "

            ' Boucle sur chaque cellule de la ligne
            For Each cell In currentRow.Cells
                If cell.Column >= 4 Then ' On ignore les colonnes avant la premi√®re filiale
                    If IsEmpty(cell.Value) Or cell.Value = "NA" Then
                        sqlQuery = sqlQuery & "'4', "  ' Remplace NA par 4
                    Else
                        sqlQuery = sqlQuery & "'" & cell.Value & "', "
                    End If
                End If
            Next cell

            ' Supprimer la derni√®re virgule et ajouter la date
            sqlQuery = Left(sqlQuery, Len(sqlQuery) - 2) & ", '" & dateValue & "');"

            ' V√©rification
            Debug.Print sqlQuery

            ' √âcrire la requ√™te dans le fichier SQL
            Print #fileNum, sqlQuery
        Next currentRow

        ' Fermer le fichier SQL et le fichier Excel
        Close #fileNum
        wb.Close False

NextFile:
        ' Passer au fichier suivant
        fichier = Dir()
    Loop

    MsgBox "Conversion termin√©e. Les fichiers SQL sont cr√©√©s dans : " & dossier, vbInformation
End Sub





Sub GenerateSQLFromMultipleFiles()
    Dim folderPath As String
    Dim fileName As String
    Dim wb As Workbook
    Dim ws As Worksheet
    Dim fileNum As Integer
    Dim sqlQuery As String
    Dim dataRange As Range
    Dim currentRow As Range
    Dim cell As Range
    Dim dateValue As String
    Dim outputFileName As String
 
    ' ?? D√©finir le dossier contenant les fichiers Excel
    folderPath = "C:\Users\taktourb\Downloads\MO\" ' Modifier avec le bon chemin
 
    ' ?? Parcourir tous les fichiers Excel dans le dossier
    fileName = Dir(folderPath & "*.xlsx")
 
    Do While fileName <> ""
        ' ?? Ouvrir chaque fichier
        Set wb = Workbooks.Open(folderPath & fileName)
        Set ws = wb.Sheets(1) ' Modifier si le nom de la feuille est diff√©rent
 
        ' ?? Lire la valeur de la colonne R3 pour la date
        dateValue = Format(ws.Range("R3").Value, "ddmmyyyy")

 
        ' ?? D√©finir le fichier de sortie pour les requ√™tes SQL
        outputFileName = folderPath & "insert_statements_" & fileName & "_" & dateValue & ".txt"
        fileNum = FreeFile
        Open outputFileName For Output As #fileNum
 
        ' ?? D√©finir la plage de donn√©es √† traiter
        Set dataRange = ws.Range("C8:Q36") ' Adapter si la plage varie
 
        ' ?? G√©n√©rer les requ√™tes SQL pour chaque ligne
        For Each currentRow In dataRange.Rows
            sqlQuery = "INSERT INTO morningcheck (`app`, `filial1`, `filial1`, `filial2`, `filial3`, `filial4`, `filial5`, `filial6`, `filial7`, `filial8`, `filial9`, `filial10`, `filial11`, `filial12`, `filial13`, `date`)  VALUES ("
 
            ' ?? Lire les valeurs de chaque cellule de la ligne
            For Each cell In currentRow.Cells
                If IsEmpty(cell.Value) Or cell.Value = "NA" Then
                    sqlQuery = sqlQuery & "'4', "  ' Remplace NA par 4
                Else
                    sqlQuery = sqlQuery & "'" & cell.Value & "', "
                End If
            Next cell
 
            ' ?? Ajouter la date et fermer la requ√™te
            sqlQuery = sqlQuery & "'" & dateValue & "');"
 
            ' ?? √âcrire la requ√™te dans le fichier
            Print #fileNum, sqlQuery
        Next currentRow
 
        ' ?? Fermer le fichier de sortie
        Close #fileNum
 
        ' ?? Fermer le fichier Excel sans sauvegarde
        wb.Close False
 
        ' ?? Passer au fichier suivant
        fileName = Dir()
    Loop
 
    MsgBox "G√©n√©ration des requ√™tes termin√©e !", vbInformation
End Sub









pip install pandas mysql-connector-python openpyxl



import os
import pandas as pd
import mysql.connector
from mysql.connector import Error

# Configuration MySQL (√† adapter selon votre XAMPP)
DB_CONFIG = {
    "host": "localhost",
    "user": "root",  # Modifier si n√©cessaire
    "password": "",   # Modifier si n√©cessaire
    "database": "nom_de_votre_base"
}

# Dossier contenant les fichiers Excel
folder_path = r"C:\Users\taktourb\Downloads\MO"

# Connexion √† MySQL
def connect_db():
    try:
        conn = mysql.connector.connect(**DB_CONFIG)
        if conn.is_connected():
            print("‚úÖ Connexion r√©ussie √† MySQL")
        return conn
    except Error as e:
        print(f"‚ùå Erreur de connexion : {e}")
        return None

# Fonction pour ins√©rer les donn√©es
def insert_data(data, conn):
    cursor = conn.cursor()
    insert_query = """
        INSERT INTO morningcheck (app, filial1, filial2, filial3, filial4, filial5, filial6, 
                                  filial7, filial8, filial9, filial10, filial11, filial12, 
                                  filial13, date)
        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s);
    """
    try:
        cursor.executemany(insert_query, data)
        conn.commit()
        print(f"‚úÖ {cursor.rowcount} lignes ins√©r√©es avec succ√®s")
    except Error as e:
        print(f"‚ùå Erreur d'insertion : {e}")
    finally:
        cursor.close()

# Lecture des fichiers Excel et traitement
def process_files():
    conn = connect_db()
    if not conn:
        return

    for file_name in os.listdir(folder_path):
        if file_name.endswith(".xlsx"):
            file_path = os.path.join(folder_path, file_name)
            print(f"üìÇ Traitement du fichier : {file_name}")

            # Lire l'Excel
            df = pd.read_excel(file_path, sheet_name=0, skiprows=7, usecols="C:Q")  # Modifier selon la structure
            df.fillna("4", inplace=True)  # Remplacer NA par 4

            # Lire la date depuis R3
            date_df = pd.read_excel(file_path, sheet_name=0, usecols="R", nrows=3)
            try:
                date_value = pd.to_datetime(date_df.iloc[2, 0]).strftime("%Y-%m-%d")
            except Exception:
                print(f"‚ùå Erreur de date dans {file_name}, fichier ignor√©")
                continue

            # Ajouter la colonne date
            df["date"] = date_value

            # Convertir en tuples pour l'insertion SQL
            data_tuples = [tuple(row) for row in df.to_numpy()]
            insert_data(data_tuples, conn)

    conn.close()
    print("‚úÖ Traitement termin√© !")

# Lancer le traitement
process_files()
